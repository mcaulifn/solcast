# Codebase Structure

**Analysis Date:** 2026-02-12

## Directory Layout

```
solcast/
├── .github/                    # GitHub Actions workflows and configuration
├── .planning/                  # GSD planning documents (generated)
├── docs/                       # Sphinx documentation source
├── pysolcast/                  # Main package source code
│   ├── __init__.py             # Package initialization (minimal)
│   ├── base.py                 # Base HTTP client class and utilities
│   ├── rooftop.py              # RooftopSite class for rooftop PV sites
│   ├── weather.py              # WeatherSite class for weather sites
│   ├── utility.py              # UtilitySite class for utility-scale sites
│   ├── world.py                # World class for location-based queries
│   └── exceptions.py           # Custom exception definitions
├── tests/                      # Test suite
│   ├── __init__.py
│   ├── test_base.py            # Tests for base class HTTP methods
│   ├── test_rooftop.py         # Tests for RooftopSite
│   ├── test_weather.py         # Tests for WeatherSite
│   ├── test_utility.py         # Tests for UtilitySite
│   └── test_world.py           # Tests for World class
├── pyproject.toml              # Poetry configuration and dependencies
├── poetry.lock                 # Locked dependency versions
├── tox.ini                     # Test environment configuration
├── .coveragerc                 # Code coverage configuration
├── README.rst                  # Project overview and usage examples
├── CHANGELOG.md                # Version history
├── CONTRIBUTING.rst            # Contribution guidelines
├── LICENSE                     # MIT license
└── .gitignore                  # Git ignore patterns
```

## Directory Purposes

**pysolcast/:**
- Purpose: Main Python package containing the Solcast API client library
- Contains: Core classes, utilities, and exception definitions
- Key files: `base.py` (core functionality), site-specific modules, `exceptions.py`

**tests/:**
- Purpose: Pytest-based test suite covering all module functionality
- Contains: Unit tests with mocked HTTP responses
- Key files: `test_base.py` (core HTTP tests), individual test modules per site type
- Coverage requirement: Enforced by tox and codecov

**docs/:**
- Purpose: Sphinx documentation source for API reference and usage guides
- Contains: RST documentation files and Sphinx configuration
- Key files: `conf.py` (Sphinx configuration)

**.planning/:**
- Purpose: GSD (Getting Stuff Done) planning documents
- Contains: Architecture, structure, conventions, and testing analysis documents
- Generated by: GSD orchestrator tools

## Key File Locations

**Entry Points:**

- `pysolcast/rooftop.py`: RooftopSite class - primary entry point for rooftop PV site interactions
- `pysolcast/weather.py`: WeatherSite class - entry point for weather site data
- `pysolcast/utility.py`: UtilitySite class - entry point for utility-scale site data
- `pysolcast/world.py`: World class - entry point for location-based solar radiation data

**Configuration:**

- `pyproject.toml`: Poetry dependency management, Python version (>=3.9), build backend configuration
- `tox.ini`: Test environment matrix (py38, py39, py310, py311, coverage, pylint)
- `.coveragerc`: Code coverage settings and exclusion patterns
- `pyproject.toml`: Black formatter configuration (max line length 120)

**Core Logic:**

- `pysolcast/base.py`: HTTP client implementation (`_get_data()`, `_post_data()`, `_create_uri()`) and date parsing utilities
- `pysolcast/exceptions.py`: Custom exception classes for error handling
- Site modules: `rooftop.py`, `weather.py`, `utility.py`, `world.py` - domain-specific API wrappers

**Testing:**

- `tests/test_base.py`: HTTP client tests, authentication, error codes (200, 429, 400, 404), timeouts
- `tests/test_rooftop.py`: RooftopSite tests including parsed forecasts and measurements
- `tests/test_weather.py`: WeatherSite tests for forecasts and actuals
- `tests/test_utility.py`: UtilitySite tests including radiation endpoints
- `tests/test_world.py`: World class tests for location-based queries

## Naming Conventions

**Files:**

- Main package: `pysolcast/` (lowercase, no hyphens)
- Module names: `lowercase_with_underscores.py` (e.g., `rooftop.py`, `base.py`, `exceptions.py`)
- Test files: `test_{{module}}.py` (e.g., `test_rooftop.py`)
- Config files: Standard Python tooling names (`pyproject.toml`, `tox.ini`, `.coveragerc`)

**Directories:**

- Source directory: `pysolcast/` (package name, lowercase)
- Test directory: `tests/` (plural, lowercase)
- Documentation: `docs/` (lowercase)

**Classes:**

- Site classes: `PascalCase` with descriptive name (e.g., `RooftopSite`, `WeatherSite`, `UtilitySite`)
- Base class: `PySolcast` (package name prefix + module concept)
- Exception classes: `PascalCase` ending with `Error` or `Exception` suffix (e.g., `ValidationError`, `SiteError`)

**Methods:**

- HTTP methods: `_get_data()`, `_post_data()` (leading underscore for protected, snake_case, descriptive verbs)
- Public API methods: `get_forecasts()`, `get_estimated_actuals()`, `post_measurements()` (snake_case, descriptive)
- Internal helpers: `_create_uri()` (leading underscore)
- Module-level functions: `parse_date_time()` (snake_case)

**Constants:**

- Base URL: `base_url` (class attribute, lowercase)
- Base URI: `base_uri` (class attribute, lowercase)
- Test constants: `BASE_URL`, `ROOFTOP_URI` (uppercase, screaming snake_case)

## Where to Add New Code

**New Site Type (e.g., Commercial Sites):**
- Primary code: `pysolcast/commercial.py` - create new class extending PySolcast with appropriate endpoints
- Tests: `tests/test_commercial.py` - follow pattern from existing test files with @responses.activate decorator
- Pattern to follow: Inherit from PySolcast, override base_uri, implement public method wrappers around `_get_data()` and `_post_data()`

**New Endpoint for Existing Site:**
- Primary code: Add method to existing site class in `pysolcast/{{site_type}}.py`
- Tests: Add test functions to corresponding `tests/test_{{site_type}}.py`
- Pattern: Create endpoint string, build params dict if needed, call inherited HTTP method

**New Utility Function:**
- Primary code: Add to `pysolcast/base.py` as module-level function
- Tests: Add to `tests/test_base.py`
- Pattern: If date parsing, follow `parse_date_time()` structure; for general utilities, define at module level

**New Exception Type:**
- Primary code: `pysolcast/exceptions.py` - add class extending Exception
- Usage: Import in `base.py` and raise in HTTP methods
- Pattern: Follow existing exception class structure with docstrings

**New Tests:**
- Location: `tests/test_{{module}}.py`
- Pattern: Use `@responses.activate` decorator, arrange-act-assert structure
- Dependencies: Import `responses` for mocking, `pytest` for assertions and fixtures
- Setup: Define BASE_URL constant, construct expected URL, add mocked response with responses.add()

## Special Directories

**pysolcast/:
- Purpose: Main package containing all production code
- Generated: No
- Committed: Yes - core library code

**tests/:
- Purpose: Test suite with unit tests for all modules
- Generated: No
- Committed: Yes - test source files (not pytest cache or coverage reports)

**.planning/:
- Purpose: GSD planning documentation
- Generated: Yes - by GSD tools
- Committed: Yes - planning documents are tracked

**.github/:
- Purpose: GitHub Actions workflows for CI/CD
- Generated: No
- Committed: Yes - workflow definitions

**docs/:
- Purpose: Sphinx documentation source
- Generated: No (source), Yes (built HTML/PDF)
- Committed: Yes (source only)

**__pycache__/, .pytest_cache/, .tox/:
- Purpose: Build artifacts and caches
- Generated: Yes
- Committed: No - listed in .gitignore

---

*Structure analysis: 2026-02-12*
